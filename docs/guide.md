==================================================  
АДМИНИСТРИРОВАНИЕ 1С ЧЕРЕЗ КОНСОЛЬ (LINUX)  
==================================================

Этот файл — единая точка входа для всех консольных операций.  
Все скрипты находятся в: /opt/1cv8/scripts/

──────────────────────────────────────────────────

1. ВЕРСИЯ ПЛАТФОРМЫ  
   ──────────────────────────────────────────────────  
    • Файл версии: /opt/1cv8/scripts/.version  
    • Все скрипты автоматически используют эту версию.  
    • При обновлении 1С — измените только этот файл.

──────────────────────────────────────────────────  
2. ОСНОВНЫЕ КОМАНДЫ RAC (через RAS на localhost:1545)  
──────────────────────────────────────────────────  
• Список кластеров:  
 rac localhost cluster list

• Список информационных баз:  
 rac localhost infobase summary list --cluster=<ID>

• Создание ИБ:  
 rac infobase create --cluster=<ID> --create-database --name=test --dbms=PostgreSQL ... localhost:1545

• Удаление ИБ (только из кластера):  
 rac localhost infobase drop --cluster=<ID> --infobase=<UUID>

──────────────────────────────────────────────────  
3. СКРИПТЫ АВТОМАТИЗАЦИИ  
──────────────────────────────────────────────────  
• backup_sql_gz.sh → бэкап всех ИБ в .sql.gz (меньший размер)  
• backup_pg_dump.sh → бэкап всех ИБ в .dump (быстрое восстановление)  
• upload_to_cloud.sh → отправка /var/backups/1c/ в Mail.ru Cloud  
• cleanup-sessions.sh → завершение неактивных сессий (>60 мин)  
• renew-ssl.sh → обновление SSL-сертификатов (запускается от root)

──────────────────────────────────────────────────  
4. ПУТИ К ДАННЫМ  
──────────────────────────────────────────────────  
• Резервные копии:  
 /var/backups/1c/sql_gz/ → .sql.gz  
 /var/backups/1c/dump/ → .dump

• Конфигурация rclone (Mail.ru Cloud):  
 /home/usr1cv8/.config/rclone/rclone.conf

• Логи 1С:  
 /var/log/1c-session-cleanup.log
/var/log/1c_backup.log  
 /var/log/1c_cloud.log

• Логи SSL:  
 /var/log/ssl-renew.log
/var/log/letsencrypt/ .

──────────────────────────────────────────────────  
5. CRON-ЗАДАЧИ  
──────────────────────────────────────────────────  
❗ У каждого пользователя свой crontab.

• От usr1cv8 (основные задачи 1С):  
 Команда: sudo crontab -u usr1cv8 -e  
 Задачи: бэкапы, очистка сессий, отправка в облако

• От root (системные задачи):  
 Команда: sudo crontab -e  
 Задачи: обновление SSL (certbot)

──────────────────────────────────────────────────  
6. SYSTEMD-СЕРВИСЫ  
──────────────────────────────────────────────────  
• Обновление SSL при старте ВМ (актуально — ВМ выключается ночью):  
 Файл: /etc/systemd/system/certbot-renow-on-boot.service  
 Управление:  
 sudo systemctl enable certbot-renew-on-boot  
 sudo systemctl start certbot-renew-on-boot  
 sudo systemctl status certbot-renew-on-boot

──────────────────────────────────────────────────  
7. СОВЕТЫ  
──────────────────────────────────────────────────  
• Все скрипты 1С запускайте от пользователя usr1cv8.  
• SSL-скрипт требует прав root.  
• Перед изменением расписания — проверьте текущий crontab.  
• После обновления 1С — обновите только /opt/1cv8/scripts/.version
